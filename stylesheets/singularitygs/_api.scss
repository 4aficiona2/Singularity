@import "api/float";
@import "api/isolation";

//////////////////////////////
// Master Grid Span mixin
//////////////////////////////
@mixin grid-span($span, $location: 1, $grid: null, $gutter: null, $output-style: null, $gutter-style: null, $options: null) {

  @if $output-style == null {
    $output-style: sgs-get('output');
  }

  $Grid: find-grid($grid);
  $Gutter: find-gutter($gutter);
  $Style: find-gutter-style($gutter-style);

  $Start-Row: start-row($location);
  $End-Row: end-row($span, $location, $Grid);

  $Fixed-Gutter: fixed-gutter($Grid, $Gutter, $Style);
  $Split-Gutter: index($Style, 'split');
  $Gutter-Property: gutter-property($Grid, $Gutter, $Style);

  $Direction: sgs-get('direction');

  $Span-Map: (
    'span': $span,
    'location': $location,
    'grid': $Grid,
    'gutter': $Gutter,
    'style': $Style,
    'start row': $Start-Row,
    'end row': $End-Row,
    'fixed gutter': $Fixed-Gutter,
    'split gutter': $Split-Gutter,
    'gutter property': $Gutter-Property,
    'options': $options
  );


  @if function-exists('output-#{$output-style}') {
    $Call: call('output-#{$output-style}', $Span-Map);

    $Left: map-get($Call, 'left');
    $Right: map-get($Call, 'right');
    $Exclude: map-get($Call, 'exclude');
    $Exclude-Left: map-get($Exclude, 'left');
    $Exclude-Right: map-get($Exclude, 'right');

    @if $Direction == 'ltr' or $Direction == 'both' {
      @each $property, $value in $Left {
        @if $Direction == 'both' {
          @if not index($Exclude-Left, $property) {
            #{$property}: $value;
          }
        }
        @else {
          #{$property}: $value;
        }
      }
    }

    @if $Direction == 'rtl' or $Direction == 'both' {
      [dir="rtl"] {
        @each $property, $value in $Right {
          @if $Direction == 'both' {
            @if not index($Exclude-Right, $property) {
              #{$property}: $value;
            }
          }
          @else {
            #{$property}: $value;
          }
        }
      }
    }
  }
  @else {
    @warn "There doesn't appear to be an output style named `#{$output-style}`. Please ensure that the function `output-#{$output-style}` and that the output style `#{$output-style}` are both available before trying to use them.";
  }
}